name: "Build"
description: "Builds and caches"
inputs:
  goversion:
    description: "Go version"
  goos:
    description: "Target OS"
  goarch:
    description: "Target architecture"
runs:
  using: composite
  steps:
    - uses: actions/setup-go@v5
      with:
        go-version: ${{ inputs.goversion }}
    - uses: actions/cache@v4
      with:
        path: /home/runner/go/bin
        key: ${{ runner.os }}-go-${{ hashFiles('go.sum') }}
    - shell: bash
      if: inputs.goos == 'linux'
      run: GOOS=${{ inputs.goos }} GOARCH=${{ inputs.goarch }} go build -o llm-language-server ./main.go
    - shell: pwsh
      if: inputs.goos == 'windows'
      run: GOOS=${{ inputs.goos }} GOARCH=${{ inputs.goarch }} go build -o llm-language-server.exe ./main.go
    - shell: bash
      if: inputs.goos == 'darwin'
      run: GOOS=${{ inputs.goos }} GOARCH=${{ inputs.goarch }} go build -o llm-language-server ./main.go
